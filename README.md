# GeoTIFF 3D Viewer

React、JavaScript、Babylon.jsを使用してGeoTIFFファイルを3次元で表示するWebアプリケーションです。

## 機能

- **GeoTIFFファイルの読み込み**: .tif/.tiff形式の地理空間データをサポート
- **3D地形表示**: 標高データを3次元の地形として可視化
- **大規模データ対応**: 500MB以上のファイルを自動的に最適化
- **プログレッシブローディング**: 大規模ファイルの段階的読み込み
- **メモリ管理**: リアルタイムメモリ使用量監視と自動クリーンアップ
- **解像度自動調整**: パフォーマンスに応じた解像度の動的調整
- **インタラクティブな操作**: マウスとキーボードによる3Dシーンの操作
- **リアルタイム設定調整**: 標高スケール、表示モードなどの動的変更
- **レスポンシブデザイン**: デスクトップとモバイルデバイスに対応

## 技術スタック

- **React 18**: ユーザーインターフェース
- **Babylon.js 6.0**: 3Dレンダリングエンジン
- **GeoTIFF**: 地理空間データの読み込み
- **Proj4**: 座標系変換
- **CSS3**: スタイリングとレスポンシブデザイン

## インストール

1. 依存関係のインストール:
```bash
npm install
```

2. 開発サーバーの起動:
```bash
npm start
```

3. ブラウザで `http://localhost:3000` を開く

## 使用方法

1. **ファイルのアップロード**: 
   - ドラッグ&ドロップまたはファイル選択ボタンでGeoTIFFファイルをアップロード
   - 対応形式: .tif, .tiff
   - 最大ファイルサイズ: 100MB

2. **3D表示の操作**:
   - マウス左ドラッグ: シーンの回転
   - マウス右ドラッグ: パン（平行移動）
   - マウスホイール: ズームイン/アウト
   - WASDキー: カメラの移動

3. **表示設定の調整**:
   - 標高スケール: 地形の高さの強調度を調整
   - ワイヤーフレーム表示: メッシュ構造の表示/非表示
   - グリッド表示: 背景グリッドの表示/非表示
   - カメラ速度: カメラ移動の速度調整

## 対応データ形式

- **GeoTIFF**: 地理参照付きTIFFファイル
- **投影法**: WGS84 (EPSG:4326), Web Mercator (EPSG:3857), UTM等
- **データ型**: 16bit, 32bit整数および浮動小数点
- **圧縮**: LZW, PackBits, JPEG等の一般的な圧縮形式
- **ファイルサイズ**: 最大1GB（500MB以上は自動最適化）

## パフォーマンス最適化

- **大規模データ対応**: 500MB以上のファイルを自動的に解像度調整
- **プログレッシブローディング**: 段階的なデータ読み込みでメモリ効率を向上
- **メモリ管理**: リアルタイム監視と自動クリーンアップ
- **解像度自動調整**: 最大2048×2048ピクセルに制限してパフォーマンスを維持
- **チャンクベース読み込み**: 大規模ファイルの分割読み込み（将来拡張）
- **レンダリング最適化**: Babylon.jsによる高速3Dレンダリング
- **レスポンシブ表示**: デバイス性能に応じた品質調整

## ブラウザサポート

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## ライセンス

MIT License

## 貢献

プルリクエストやイシューの報告を歓迎します。

## トラブルシューティング

### よくある問題

1. **ファイルが読み込めない**:
   - ファイル形式がGeoTIFFであることを確認
   - ファイルサイズが1GB以下であることを確認
   - ブラウザのコンソールでエラーメッセージを確認

2. **表示が正しくない**:
   - 標高スケールを調整してみる
   - ブラウザのWebGLサポートを確認
   - ハードウェアアクセラレーションが有効か確認

3. **パフォーマンスが遅い**:
   - 大規模ファイル（500MB以上）は自動的に最適化されます
   - メモリ使用量を右上の情報パネルで確認
   - 他のタブを閉じてメモリを解放
   - ブラウザを再起動

4. **大規模ファイルの処理**:
   - 500MB以上のファイルは解像度が自動調整されます
   - 元の解像度と調整後の解像度が情報パネルに表示されます
   - メモリ使用量が制限を超える場合は自動的にクリーンアップされます

## 開発者向け情報

### プロジェクト構造

```
src/
├── components/          # Reactコンポーネント
│   ├── BabylonViewer.js    # 3Dビューアー
│   ├── FileUploader.js     # ファイルアップロード
│   └── ControlPanel.js     # 設定パネル
├── utils/              # ユーティリティ
│   └── GeoTIFFLoader.js    # GeoTIFF読み込み
├── App.js              # メインアプリケーション
└── index.js            # エントリーポイント
```

### カスタマイズ

- 地形の色やマテリアルを変更するには `BabylonViewer.js` を編集
- 新しいファイル形式をサポートするには `GeoTIFFLoader.js` を拡張
- UIのスタイルを変更するには各コンポーネントのCSSファイルを編集
